# 多類型新聞聚合器 - 使用說明書

> 自動抓取 AI、台股、美股新聞，透過 GPT-5.2 深度分析，推送至 Slack 並記錄到 Google Sheet

---

## 目錄

1. [快速開始](#快速開始)
2. [新聞類型](#新聞類型)
3. [命令列使用](#命令列使用)
4. [設定檔說明](#設定檔說明)
5. [GitHub Actions 排程](#github-actions-排程)
6. [Google Sheet 欄位](#google-sheet-欄位)
7. [常見問題](#常見問題)

---

## 快速開始

### 本地執行

```bash
# 進入專案目錄
cd ai-news-aggregator

# 啟動虛擬環境
source venv/bin/activate

# 執行 AI 新聞（預設）
python -m src.main

# 執行台股新聞
python -m src.main --news-type tw_stock

# 執行美股新聞
python -m src.main --news-type us_stock
```

### 測試模式

不發送 Slack 通知、不寫入 Google Sheet：

```bash
python -m src.main --news-type ai --dry-run
```

---

## 新聞類型

| 類型 | 參數值 | 說明 | RSS 來源數 |
|------|--------|------|-----------|
| AI 新聞 | `ai` | 人工智慧、機器學習、LLM 相關 | 15 個 |
| 台股新聞 | `tw_stock` | 台灣股市、上市櫃公司 | 6 個 |
| 美股新聞 | `us_stock` | 美國股市、科技巨頭 | 6 個 |

### AI 新聞來源

- TechCrunch AI
- VentureBeat AI
- The Verge AI
- MIT Technology Review
- Hacker News
- arXiv AI/ML
- Wired AI
- Ars Technica
- IEEE Spectrum AI
- Hugging Face Blog
- NVIDIA AI Blog
- DeepMind Blog
- Microsoft AI Blog
- The Batch (Andrew Ng)
- Import AI

### 台股新聞來源

- 經濟日報證券
- 經濟日報焦點
- 聯合新聞網財經
- Yahoo 台灣股市
- MoneyDJ 台股新聞
- ETtoday 財經

### 美股新聞來源

- Yahoo Finance
- CNBC Top News
- MarketWatch
- Seeking Alpha
- Bloomberg Markets
- WSJ Markets

---

## 命令列使用

### 基本語法

```bash
python -m src.main [選項]
```

### 選項說明

| 選項 | 縮寫 | 說明 | 預設值 |
|------|------|------|--------|
| `--news-type` | `-t` | 新聞類型 | `ai` |
| `--dry-run` | - | 測試模式 | `false` |

### 使用範例

```bash
# AI 新聞（完整執行）
python -m src.main --news-type ai

# 台股新聞（測試模式）
python -m src.main -t tw_stock --dry-run

# 美股新聞
python -m src.main --news-type us_stock
```

---

## 設定檔說明

設定檔位置：`config.yaml`

### 主要設定區塊

#### 1. 全域設定

```yaml
global:
  default_news_type: ai  # 預設新聞類型
```

#### 2. 新聞類型定義

每種新聞類型包含：

```yaml
news_types:
  ai:
    name: "AI 新聞"           # 顯示名稱
    slack_title: "🤖 AI 新聞摘要"  # Slack 標題
    feeds:                    # RSS 來源列表
      - name: TechCrunch AI
        url: https://techcrunch.com/category/artificial-intelligence/feed/
        enabled: true
    keywords:                 # 關鍵字過濾
      required: [...]         # 必須包含的關鍵字
      blocked: [...]          # 排除的關鍵字
```

#### 3. 摘要設定

```yaml
digest:
  max_articles: 20            # Slack 推送上限
  min_score: 5                # 最低評分門檻
  articles_per_feed: 15       # 每個來源抓取數量
  process_all_filtered: true  # 處理所有過濾後文章
```

#### 4. LLM 設定

```yaml
llm:
  model: gpt-5.2-2025-12-11   # 模型版本
  max_completion_tokens: 8000  # 最大 token 數
  temperature: 0.3            # 溫度（越低越穩定）
  timeout: 120                # 請求超時（秒）
```

### 新增/修改 RSS 來源

在對應的新聞類型下新增：

```yaml
news_types:
  ai:
    feeds:
      - name: 新來源名稱
        url: https://example.com/rss
        enabled: true  # 設為 false 可暫時停用
```

### 調整評分門檻

修改 `digest.min_score`：

```yaml
digest:
  min_score: 6  # 提高門檻，只推送更重要的新聞
```

---

## GitHub Actions 排程

### 自動執行時間

| 新聞類型 | UTC 時間 | 台灣時間 | 頻率 |
|----------|----------|----------|------|
| AI 新聞 | 00:00 | 08:00 | 每天 |
| 台股新聞 | 10:00 | 18:00 | 週一至週五 |
| 美股新聞 | 14:00 | 22:00 | 週一至週五 |

### 手動觸發

1. 前往 GitHub Actions 頁面
2. 選擇 **Multi-Type News Digest**
3. 點擊 **Run workflow**
4. 選擇新聞類型
5. 點擊 **Run workflow** 執行

### 修改排程時間

編輯 `.github/workflows/daily-digest.yml`：

```yaml
schedule:
  # AI 新聞：修改為 UTC 01:00（台灣 09:00）
  - cron: '0 1 * * *'
  
  # 台股新聞：修改為 UTC 09:00（台灣 17:00）
  - cron: '0 9 * * 1-5'
```

---

## Google Sheet 欄位

每次執行會建立新分頁，格式：`YYYY/MM/DD HH:MM 類型名稱`

### 欄位說明

| 欄位 | 說明 | 範例 |
|------|------|------|
| 抓取時間 | 執行時間戳記 | 2026-01-23 13:00:00 |
| 類型 | 新聞類型 | AI 新聞 / 台股新聞 / 美股新聞 |
| 標題 | 文章標題 | OpenAI 發布新模型... |
| URL | 文章連結 | https://... |
| 來源 | RSS 來源名稱 | TechCrunch AI |
| 評分 | AI 評分（1-10） | 8 |
| 分類 | 文章分類 | INDUSTRY / PRODUCT / RESEARCH |
| AI 摘要 | 300-500 字詳細摘要 | （支援換行） |
| 關聯企業 | 可能受影響的公司 | 2330 台積電、NVDA... |
| 市場影響 | 短期/中期市場影響 | （支援換行） |
| 投資觀點 | 潛在機會或風險 | （支援換行） |
| 發布時間 | 文章發布時間 | 2026-01-23 12:00 |

### 分類說明

| 分類 | 說明 |
|------|------|
| RESEARCH | 學術研究、論文、技術突破 |
| PRODUCT | 產品發布、功能更新、服務上線 |
| INDUSTRY | 產業動態、併購、融資、人事異動 |
| MARKET | 市場動態、股價、財報、法人動向 |
| POLICY | 政策、法規、監管 |
| OPINION | 評論、分析、預測 |

---

## 常見問題

### Q1: 如何新增新的新聞類型？

在 `config.yaml` 的 `news_types` 下新增：

```yaml
news_types:
  crypto:  # 新類型 ID
    name: "加密貨幣新聞"
    slack_title: "₿ 加密貨幣新聞"
    feeds:
      - name: CoinDesk
        url: https://www.coindesk.com/arc/outboundfeeds/rss/
        enabled: true
    keywords:
      required:
        - Bitcoin
        - Ethereum
        - crypto
      blocked:
        - sponsored
```

然後在 `.github/workflows/daily-digest.yml` 新增對應的 Job。

### Q2: 如何調整 Slack 推送的文章數量？

修改 `config.yaml`：

```yaml
digest:
  max_articles: 30  # 增加到 30 篇
```

### Q3: 執行時間太長怎麼辦？

1. 減少 RSS 來源數量（設 `enabled: false`）
2. 降低每個來源的抓取數量：
   ```yaml
   digest:
     articles_per_feed: 10  # 從 15 降到 10
   ```
3. 關閉全文章處理：
   ```yaml
   digest:
     process_all_filtered: false  # 只處理前 50 篇
   ```

### Q4: API 費用太高怎麼辦？

1. 使用較便宜的模型：
   ```yaml
   llm:
     model: gpt-4o-mini  # 比 gpt-5.2 便宜很多
   ```
2. 減少處理文章數量
3. 降低摘要長度（需修改 `processor.py` 的 prompt）

### Q5: 如何查看執行日誌？

- **本地執行**：直接在終端機查看
- **GitHub Actions**：在 Actions 頁面點擊對應的執行記錄

### Q6: Google Sheet 寫入失敗？

檢查：
1. `credentials.json` 是否存在
2. 服務帳戶是否有 Sheet 的編輯權限
3. Sheet ID 是否正確

---

## 環境變數

| 變數名稱 | 說明 | 必要 |
|----------|------|------|
| `SLACK_WEBHOOK_URL` | Slack Incoming Webhook URL | ✅ |
| `OPENAI_API_KEY` | OpenAI API Key | ✅ |
| `LOG_LEVEL` | 日誌等級（DEBUG/INFO/WARNING/ERROR） | ❌ |

### 本地設定

建立 `.env` 檔案：

```
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx
OPENAI_API_KEY=sk-xxx
```

### GitHub Secrets

在 Repository Settings > Secrets and variables > Actions 新增：

- `SLACK_WEBHOOK_URL`
- `OPENAI_API_KEY`
- `GOOGLE_CREDENTIALS`（Google 服務帳戶 JSON 內容）

---

## 聯絡與支援

如有問題，請聯繫開發團隊或提交 GitHub Issue。

---

*最後更新：2026-01-23*
